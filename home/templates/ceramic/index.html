{% load static %}
<!Doctype html>
<html class="no-js" lang="zxx">
    <head>
        <!-- Meta Tags -->
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="keywords" content="Site keywords here">
		<meta name="description" content="">
		<meta name='copyright' content=''>
        <meta name="viewport" content="width=device-width, initial-scale=1">
		<!-- Title -->
        <title>KCC | Register Potter Inventory</title>
		
		<!-- Favicon -->
        <link rel="icon" href="{% static 'img/favicon.ico' %}">
		
        <!-- Google Fonts -->
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Kantumruy+Pro:ital,wght@0,100..700;1,100..700&display=swap" rel="stylesheet">

        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Battambang:wght@100;300;400;700;900&family=Content:wght@400;700&display=swap" rel="stylesheet">

        <!-- Bootstrap CSS -->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">

        <script src="{% static 'django_ckeditor_5/app.js' %}"></script>

        <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
                font-family: 'Content', sans-serif;
            } 

            input[type='text'], 
            input[type='url'], 
            input[type='date'],
            input[type='number'], 
            select,
            textarea {
                padding: 14px 10px;
                width: 100%;
                border: 1px solid #ddd;
                margin-bottom: 20px !important;
            }
            textarea:focus, input:focus{
                outline: none;
                border: 1px solid #000000;
            }
            input[type='file'] {
                width: 100%;
                padding: 12px;
                border: 1px solid #ddd;
            }
            .g-recaptcha {
                margin-top: 12px;
            }
        </style>
    </head>
    <body>
        <div class="container-fluid" style="padding: 0;">
            <div class="ceramic-app-form-title-header" style="text-align: center !important;
                border-bottom: 1px solid #dddddd87;
                margin-bottom: 40px;
                border-top: 1px solid #dddddd87;
                box-shadow: 0 0 30px #dddddd87;"
            >
                <div class="row" style="text-align: center !important;">
                    <div class="col-md-12 mb-4">
                        <img src="{% static 'img/logo-2.png' %}" width="100" alt="#">
                        <img src="{% static 'img/logo-7.png' %}" width="150" alt="#">
                        <img src="{% static 'img/waseda.png' %}" width="220" alt="#">
                        <img src="{% static 'img/rufa_logo.png' %}" width="90" alt="#">
                    </div>
                    <h4 id="inventory-pottery-title" style="font-family: 'Moul' !important; text-align: center;">បញ្ជីសារពើភណ្ឌអ្នកផលិតកុលាលភាជន៍ក្នុងប្រទេសកម្ពុជា</h4>
                    <p style="font-size: 18px; text-transform: uppercase;" class="mb-3">Inventory of Pottery Maker in Cambodia</p>
                </div>
            </div>
            <div class="container" style="max-width: 640px; margin: 0 auto;">

                {% if messages %}
                    <div class="alert alert-danger mt-3 alert-dismissible fade show" role="alert">
                        <ul class="messages" style="list-style: none; margin-bottom: 0 !important; margin-left: -30px !important;">
                        {% for message in messages %}
                            <li{% if message.tags %} class="{{ message.tags }}"{% endif %}>{{ message }}   <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                        </li>
                        {% endfor %}
                        </ul>
                    </div>
                {% endif %}

                <form id="" action="potter" method="POST" enctype="multipart/form-data">
                    {% csrf_token %}
                    {{ potter_form.media }}
                    {% for field in potter_form %}
                        <div class="row mb-4">
                           <div class="col-md-12">
                                {{ field.label_tag }}
                                {{ field }}

                                {% if potter_form.errors %}
                                    {% for error in field.errors %}
                                        <ul class="errorlist mt-3" style="color: rgba(196, 71, 71, 0.855);">
                                            <li>{{ error }}</li>
                                        </ul>
                                    {% endfor %}
                                {% endif %}

                                {% if field.name == 'created_at' %}
                                    <div class="mt-2">
                                        <h5 class="" style="font-weight: 600; color: #1a73e8; font-size: 24px;">I. ព័ត៍មានទូទៅរបស់ស្មូន / General information</h5>
                                    </div>
                                {% endif %}
                                {% if field.name == 'type_of_pottery' %}
                                    <div class="mt-4">
                                        <b style="color: #1a73e8; font-size: 24px;">ទីកន្លែងកំណើត / Place of Birth *</b>
                                    </div>
                                {% endif %}
    
                                {% if field.name == 'village_of_pob' %}
                                    <div class="mt-4">
                                        <b style="color: #1a73e8; font-size: 24px;">លំនៅឋានបច្ចុបន្ន / Current Address</b>
                                    </div>
                                {% endif %}

                                {% if field.name == 'village_of_address' %}
                                <div class="mt-4">
                                    <b style="color: #1a73e8; font-size: 24px;">និយាមការផ្ទះ / Coordinate</b>
                                </div>
                                {% endif %}
    
                                {% if field.name == 'describe' %}
                                <div class="mt-4 mb-0">
                                    <b style="color: #1a73e8; font-size: 24px;">រូបភាព / Photos</b>
                                </div>
                                {% endif %}
                           </div>
                        </div>
                    {% endfor %}

                    <div class="mb-3">
                        {{ formset.management_form }}
                    </div>
                    {% for form in formset %}
                        <div class="mb-4">
                        {{ form.as_table }}
                        </div>
                    {% endfor %}

                    <div class="row mt-5">
                        <div class="col-md-12">
                            <h5 class="" style="font-weight: 600; color: #1a73e8; font-size: 24px;">II. របៀបនៃការផលិត / Technique</h5>
                        </div>
                        <div class="col-md-12 mb-4" style="display: flex;
                        justify-content: end;">
                            <button type="button" class="btn btn-outline-secondary btn-sm" onclick="addFields()">បន្ថែម / Add</button>
                            <button type="button" style="margin-left: 10px;" class="btn btn-outline-danger btn-sm" onclick="removeFields()">លុប / Delete</button>
                        </div>
                    </div>
                    <div id="field-container">
                        <div class="form-fields">
                                <div class="col-md-12 mb-3">
                                    <label for="technique-title" >1. ចំណងជើង / Title</label>
                                    <input type="text" name="title[]" id="title-input" required autocomplete="off">
                                </div>
                                <div class="col-md-12 mb-3">
                                    <label for="description">ពិពណ៌នា / Description</label>
                                    <textarea name="description[]" id="description-input" required autocomplete="off" rows="12"></textarea>                
                                </div>
                                <div class="col-md-12 mb-5">
                                    <label for="photo">រូបថត / Photo</label>
                                    <input type="file" name="image[]" class="" id="images-input" multiple accept="image/png, image/gif, image/jpeg">
                                </div>
    
                        </div>
                    </div>

                    <div class="row mb-5 mt-5">
                        <div class="mb-3">
                            {{ recaptcha_form }}
                        </div>
                        <div class="">
                            <input type="submit" class="btn btn-primary btn-lg" value="រក្សារទុកស្មូន / Save Potter">
                        </div>
                    </div>
    
                </form>
            </div>

        </div>

        <script>
            function addFields() {
                const container = document.getElementById('field-container');
                const clone = container.firstElementChild.cloneNode(true);
                
                // Increment the index for the new set of fields
                const newIndex = container.childElementCount + 1;

                // Update the label for the title field with the new index
                const titleLabel = clone.querySelector('label[for="technique-title"]');
                titleLabel.textContent = `${newIndex}. ចំណងជើង / Title `;

                // Clear the input values in the cloned fields
                const inputFields = clone.querySelectorAll('input, textarea');
                inputFields.forEach(field => {
                    field.value = '';
                });
                container.appendChild(clone);
            }
            function removeFields() {
                const container = document.getElementById('field-container');
                const forms = container.querySelectorAll('.form-fields');
                if (forms.length > 1) {
                    container.removeChild(forms[forms.length - 1]);
                }
            }

        </script>

        <!-- Bootstrap 5.0.2 JS -->
        <script 
            src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" 
            integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" 
            crossorigin="anonymous"></script>

        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
        <script>
            $(function() {
                // Add refresh button after field (this can be done in the template as well)
                $('img.captcha').after(
                        $('<a href="#void" class="captcha-refresh btn btn-sm btn-outline-secondary" style="margin-left: 20px;">Refresh</a><br><br>')
                );

                $('legend').remove()
                $('#id_captcha_1').addClass('form-control form-control-sm')
                $('#id_captcha_1').attr('placeholder', 'សូមវាយអក្សរ៤ខ្ទង់ ខាងលើឲ្យបានត្រឹមត្រូវ')
                // Click-handler for the refresh-link
                $('.captcha-refresh').click(function(){
                    var $form = $(this).parents('form');
                    var url = location.protocol + "//" + window.location.hostname + ":"
                            + location.port + "/captcha/refresh/";

                    // Make the AJAX-call
                    $.getJSON(url, {}, function(json) {
                        $form.find('input[name="captcha_0"]').val(json.key);
                        $form.find('img.captcha').attr('src', json.image_url);
                    });

                    return false;
                });
            });
        </script>
    </body>
    
</html>